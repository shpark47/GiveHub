<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<link href="/css/reset.css" rel="stylesheet" type="text/css">
	<link href="/css/common.css" rel="stylesheet" type="text/css">
	<link href="/css/navBar.css" rel="stylesheet" type="text/css">
	<link href="/css/page.css" rel="stylesheet" type="text/css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>

#findPasswordTop {
    margin-bottom: 10px;
    font-size: 24px;
    color: #333;
    text-align: center;
}

.subtitle {
    font-size: 16px;
    color: #888;
    margin-bottom: 20px;
}

.help-text{
	
	 color: #5cc78d;
	 font-size: 14px;
	 text-align: left;
}

th {
    font-size: 14px;
    color: #555;
    padding-bottom: 10px;
}

label {
    font-size: 14px;
    color: #555;
    margin-bottom: 5px;
    display: block;
}

#memName, #memEmail {
    width: 100%;
    padding: 10px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    margin-bottom: 10px;
}

#hyde1, #hyde2 {
	color : #5cc78d;
	text-align: left;
    font-size: 12px;
    font-weight: lighter;
	
}

.find-btn {
    width: 100%;
    padding: 15px;
    background-color: #5cc78d;
    color: white;
    border: none;
    border-radius: 6px; 
    font-size: 18px;
    font-weight: bold; 
    cursor: pointer;
    margin-top: 15px;
}

.find-btn:hover {
    background-color: #4caf75;
}

.main_menu_wrap a {
	color: #1a1a1a !important;
}


.login_wrap button {
	background: none;
	color: #1a1a1a !important;
	border: none;
	font-size: 1rem;
	font-weight: 500;
	cursor: pointer;
}</style>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<div th:replace="~{/common/navbar.html :: navbar}"></div>
<script src="/js/common.js"></script>
    <form id="findPassword" method="post">
        <table align="center" style="margin-top: 100px;">
			<tr>
				<td>
					<h2 id="findPasswordTop">비밀번호 찾기</h2> <br>
					 <p class="subtitle">회원가입시 입력한 정보로 비밀번호를 찾을 수 있습니다.</p>
				</td>
			</tr>
			
			<tr>
				<th>
	       		 	<input type="text" id="memName" name="memName" placeholder="이름을 입력해 주세요" required>
			 	    <div id='hyde1' style="visibility: hidden">회원가입 시 등록한 이름을 입력해 주세요</div>
				</th>			
			</tr>
	
			<tr>
				<th>
			 		<input  type="email" id="memEmail" name="memEmail" placeholder="이메일을 입력해 주세요" required>
			        <div id='hyde2' style="visibility: hidden">회원가입 시 입력한 이메일을 입력해 주세요</div>
				</th>			
			</tr>
			
			<tr>
				<th align="center">
					<button type="button" class="find-btn" id="prove_btn" >이메일로 인증</button>
				</th>
			</tr>
		</table>
	</form>
	
	<div class="form-group" id="mail_number" name="mail_number" style="visibility: hidden">
         <input type="text" name="confirmNumber" id="confirmNumber" class="form-control" style="width:250px; margin-top: -10px" placeholder="인증번호 입력">
         <span id="mail-check-warn"></span>
         <button type="button" name="confirmBtn" id="confirmBtn" style="margin-top: 20px">이메일 인증</button>
         <br>
         <input type="hidden" id="Confirm" name="Confirm" value="">
	</div>
	
	
	
	
	
	<script type="text/javascript">
	
	const hyde1 = document.getElementById('hyde1');
	
	const pass1 = document.getElementById('memName');
	pass1.addEventListener('click',()=>{
		hyde1.style.visibility = 'visible';
	})
	
	document.addEventListener('click',(event)=>{
		if(!pass1.contains(event.target)){
			hyde1.style.visibility = 'hidden';
		}
	})
		

	

	const hyde2 = document.getElementById('hyde2');
	
	const pass2 = document.getElementById('memEmail');
	pass2.addEventListener('click',()=>{
		hyde2.style.visibility = 'visible';
	})
	
	document.addEventListener('click',(event)=>{
		if(!pass2.contains(event.target)){
			hyde2.style.visibility = 'hidden';
		}
	})
	
	
	document.getElementById('prove_btn').addEventListener('click',()=>{
		$.ajax({
			url:'/findPwdemailCheck',
			method:'post',
			data:{email:document.getElementById('memEmail').value},
			success:data=>{
                   document.querySelector('#Confirm').value = data;
                   document.querySelector('#mail_number').style.visibility = 'visible';
				   alert("메일함을 열어보세요.");

			},
			error:data=> {
				console.log('실패');
				alert("메일 요청에 실패했습니다. 다시 시도해주세요.");
			}
		});
	});
	
	document.getElementById('confirmBtn').addEventListener('click',()=>{
		const confirmNumber = document.getElementById('confirmNumber').value;
		const confirm = document.getElementById('Confirm').value;
		const email = document.getElementById('memEmail').value;
		if(confirmNumber == confirm){
			
			$.ajax({
				type:'POST',
				url:'/temporaryPwd',
				data: {email:email},
				success: data=>{
					alert('인증이 완료되었습니다. 임시비밀번호가 발급됩니다.');
					const tempPwd = data.pwd;
					const memName = data.memName;
					
					window.location.href=`/findmypasswordsuccess?pwd=${encodeURIComponent(tempPwd)}&memName=${encodeURIComponent(memName)}`;
					
				},
				error:data=>alert('임시비밀번호 발급 실패')
			});
			
			
		}else{
			alert('인증 실패');
		}
	});
	
	
	
	
	
    
    
	</script>

<footer>
	<div th:replace="~{/common/footer.html :: footer_bar}"></div>
</footer>
	

	
</body>
</html>